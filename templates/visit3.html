{% extends 'layout.html' %}
{% block title %}พบลูกค้าครั้งที่ 3{% endblock %}
{% block content %}
<div class="container mt-4">
  <h3 class="mb-4">📄 ฟอร์มพบลูกค้าครั้งที่ 3 (ข้อมูลเมื่อได้งาน)</h3>

  <form method="POST">
    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">✅ ได้งาน:</label><br>
        <input type="checkbox" name="got_job" {% if customer['decision_status'] == 'ได้' %}checked{% endif %}>
        <label>ติ๊กหากได้รับงาน</label>
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label">📝 วันที่ทำสัญญา:</label>
        <input type="date" name="contract_date" class="form-control">
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label">📋 งวดการชำระเงิน (มัดจำ, งวดที่ 1, ...):</label>
        <input type="text" name="payment_schedule" class="form-control">
      </div>

      <div class="col-md-6 mb-3">
  <label class="form-label">📅 วันนัดติดตามครั้งที่ 3:</label>
  <input type="date" name="follow_up_date_3" class="form-control">
</div>

      <div class="col-md-6 mb-3">
        <label class="form-label">🎯 วันสิ้นสุดงาน:</label>
        <input type="date" name="work_end" class="form-control">
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">📝 หมายเหตุเพิ่มเติม:</label>
      <textarea name="note" class="form-control" rows="3"></textarea>
    </div>

    <hr class="my-4">

    <h4>💰 ฟอร์มบันทึกรับเงิน</h4>

    <div class="row">
      <div class="col-md-3 mb-3">
        <label class="form-label">📅 วันที่รับเงิน:</label>
        <input type="date" name="payment_date" class="form-control">
      </div>
      <div class="col-md-3 mb-3">
        <label class="form-label">🧾 งวด:</label>
        <input type="text" name="payment_phase" class="form-control" placeholder="เช่น มัดจำ, งวดที่ 1">
      </div>
      <div class="col-md-3 mb-3">
        <label class="form-label">💸 จำนวนเงิน:</label>
        <input type="number" name="amount" class="form-control" step="0.01">
      </div>
      <div class="col-md-3 mb-3">
        <label class="form-label">📝 หมายเหตุ:</label>
        <input type="text" name="payment_note" class="form-control">
      </div>
    </div>

    <div class="text-center">
      <button type="submit" class="btn btn-success">💾 บันทึก</button>
      <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">ย้อนกลับ</a>
      <button type="reset" class="btn btn-warning">🧹 เคลียร์</button>
    </div>
  </form>

  {% if payments %}
    <hr class="my-5">
    <h4>📊 รายการรับเงินที่ผ่านมา</h4>
    <table class="table table-bordered">
      <thead class="table-light">
        <tr>
          <th>วันที่</th>
          <th>งวด</th>
          <th>จำนวนเงิน</th>
          <th>หมายเหตุ</th>
        </tr>
      </thead>
      <tbody>
        {% for p in payments %}
        <tr>
          <td>{{ p['payment_date'] }}</td>
          <td>{{ p['payment_phase'] }}</td>
          <td>{{ p['amount'] }}</td>
          <td>{{ p['note'] }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
</div>
{% endblock %}

