{% extends 'layout.html' %}
{% block title %}‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î{% endblock %}
{% block content %}

{% if due_today %}
  <div class="alert alert-warning">üîî ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</div>
  <ul>
    {% for d in due_today %}
      <li>üìû {{ d['name'] }} - {{ d['phone'] }}</li>
    {% endfor %}
  </ul>
{% endif %}

<p>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô: {{ ordered }}</p>
<p>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò: {{ not_ordered }}</p>
<a href="{{ url_for('add_customer') }}" class="btn btn-primary mb-3">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</a>


<!-- üîΩ ‡∏ß‡∏≤‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
<div style="max-width: 600px; margin: 30px auto;">
  <canvas id="statusChart" height="100"></canvas>
</div>

<!-- ‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡∏≠‡∏µ‡∏Å 20%) -->
<!-- ‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡∏≠‡∏µ‡∏Å 20%) -->
<div style="max-width: 600px; margin: auto;">
  <canvas id="statusChart" height="180"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('statusChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    ...
  });
</script>







<div class="table-responsive mt-4">
  <table class="table table-bordered table-sm text-center align-middle">
    <thead class="table-light">
      <tr>
        <th>‡∏ä‡∏∑‡πà‡∏≠</th>
        <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</th>
        <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
        <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
        <th>‡∏ß‡∏±‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
        <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
      </tr>
    </thead>
    <tbody>
      {% for c in customers %}
        <tr>
          <td>{{ c['name'] }}</td>
          <td>{{ c['phone'] }}</td>
          <td>{{ c['location'] }}</td>
          <td>{{ c['price'] }}</td>
          <td>{{ c['product_type'] }}</td>
          <td>{{ c['follow_up_date'] }}</td>
          <td>{{ c['decision_status'] }}</td>
          <td>{{ c['note'] }}</td>
          <td>
            <form method="POST" action="{{ url_for('delete_customer', customer_id=c['id']) }}" style="display:inline;">
              <button type="submit" class="btn btn-danger btn-sm">‡∏•‡∏ö</button>
            </form>
            <a href="{{ url_for('edit_status', customer_id=c['id']) }}" class="btn btn-warning btn-sm">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('statusChart').getContext('2d');
new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô', '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò', '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à'],
        datasets: [{
            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤',
            data: [{{ ordered }}, {{ not_ordered }}, {{ undecided_count }}],
            backgroundColor: ['#28a745', '#dc3545', '#ffc107'],
            borderRadius: 5
        }]
    },
    options: {
        indexAxis: 'y',
        responsive: true,
        plugins: {
            legend: { display: false }
        }
    }
});
</script>
{% endblock %}