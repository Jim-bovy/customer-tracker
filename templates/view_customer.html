{% extends 'layout.html' %}
{% block title %}р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕ер╕╣р╕Бр╕Др╣Йр╕▓{% endblock %}
{% block content %}

<div class="container mt-4">
  <h2 class="mb-3">ЁЯУЛ р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕ер╕╣р╕Бр╕Др╣Йр╕▓: {{ customer['name'] }}</h2>

  <div class="card p-3 shadow-sm mb-4">
    <p><strong>ЁЯУЮ р╣Ар╕Ър╕нр╕гр╣Мр╣Вр╕Чр╕г:</strong> {{ customer['phone'] }}</p>
    <p><strong>ЁЯзСтАНЁЯТ╝ р╣Ар╕Лр╕ер╕ер╣Мр╕Ьр╕╣р╣Йр╕Фр╕╣р╣Бр╕е:</strong> {{ customer['sale_name'] }}</p>
    <p><strong>ЁЯУЕ р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Хр╕┤р╕Фр╕Хр╣Ир╕н:</strong> {{ customer['contact_date'] }}</p>
    <p><strong>ЁЯФБ р╕зр╕▒р╕Щр╕Хр╕┤р╕Фр╕Хр╕▓р╕б:</strong> {{ customer['follow_up_date'] }}</p>
    <p><strong>ЁЯПв р╕лр╕Щр╣Ир╕зр╕вр╕Зр╕▓р╕Щ:</strong> {{ customer['agency_type'] }}</p>
    <p><strong>ЁЯУН р╕кр╕Цр╕▓р╕Щр╕Чр╕╡р╣И:</strong> {{ customer['location'] }}</p>
    <p><strong>ЁЯЫая╕П р╕ер╕▒р╕Бр╕йр╕Ур╕░р╕Зр╕▓р╕Щ:</strong> {{ customer['work_type'] }}</p>
    <p><strong>ЁЯУж р╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕кр╕┤р╕Щр╕Др╣Йр╕▓:</strong> {{ customer['product_type'] }}</p>
    <p><strong>ЁЯТ░ р╕бр╕╣р╕ер╕Др╣Ир╕▓р╕Зр╕▓р╕Щ:</strong> {{ customer['price'] or 'р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕' }}</p>
    <p><strong>ЁЯУО р╣Ар╕нр╕Бр╕кр╕▓р╕гр╣Бр╕Щр╕Ъ:</strong>
      {% if customer['attachment'] %}
        <a href="{{ url_for('static', filename='uploads/' + customer['attachment']) }}" target="_blank">р╕Фр╕╣р╣Др╕Яр╕ер╣Мр╣Бр╕Щр╕Ъ</a>
      {% else %}
        р╣Др╕бр╣Ир╕бр╕╡р╣Др╕Яр╕ер╣Мр╣Бр╕Щр╕Ъ
      {% endif %}
    </p>
  </div>

  <div class="mb-4">
    <h4>ЁЯУЭ р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕р╕Ир╕▓р╕Бр╕Бр╕▓р╕гр╣Ар╕Юр╕┤р╣Ир╕бр╕ер╕╣р╕Бр╕Др╣Йр╕▓</h4>
    <p>{{ customer['note'] if customer['note'] else 'р╣Др╕бр╣Ир╕бр╕╡р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б' }}</p>
  </div>

  <hr>
  <h4>ЁЯУС р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 2: р╕Бр╕▓р╕гр╣Ар╕кр╕Щр╕нр╕гр╕▓р╕Др╕▓</h4>
  {% if proposal %}
  <ul>
    <li>ЁЯУЕ р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Ар╕кр╕Щр╕нр╕гр╕▓р╕Др╕▓: {{ proposal['proposal_date'] }}</li>
    <li>ЁЯТ░ р╕бр╕╣р╕ер╕Др╣Ир╕▓р╕Зр╕▓р╕Щ: {{ proposal['job_value'] }}</li>
    <li>ЁЯУМ р╕кр╕Цр╕▓р╕Щр╕░: {{ proposal['decision_status'] }}</li>
    <li>ЁЯЧгя╕П р╣Ар╕лр╕Хр╕╕р╕Ьр╕е: {{ proposal['reason'] }}</li>
    <li>ЁЯФБ р╕Щр╕▒р╕Фр╕Хр╕┤р╕Фр╕Хр╕▓р╕б: {{ proposal['follow_up_date'] }}</li>
    <li>ЁЯУЭ р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕: {{ proposal['note'] }}</li>
  </ul>
  {% else %}
  <p class="text-muted">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕е</p>
  {% endif %}

  <hr>
  <h4>ЁЯУД р╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣И 3: р╕Чр╕│р╕кр╕▒р╕Нр╕Нр╕▓</h4>
  {% if contract %}
  <ul>
    <li>ЁЯУМ р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Зр╕▓р╕Щ: {{ 'тЬЕ р╣Гр╕Кр╣И' if contract['got_job'] else 'тЭМ р╣Др╕бр╣Ир╣Гр╕Кр╣И' }}</li>
    <li>ЁЯУЕ р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Чр╕│р╕кр╕▒р╕Нр╕Нр╕▓: {{ contract['contract_date'] }}</li>
    <li>ЁЯУЖ р╕Зр╕зр╕Фр╕Зр╕▓р╕Щ: {{ contract['payment_schedule'] }}</li>
    <li>ЁЯУЕ р╣Ар╕гр╕┤р╣Ир╕бр╕Зр╕▓р╕Щ: {{ contract['work_start'] }} р╕Цр╕╢р╕З {{ contract['work_end'] }}</li>
    <li>ЁЯУЭ р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕: {{ contract['note'] }}</li>
  </ul>
  {% else %}
  <p class="text-muted">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕е</p>
  {% endif %}

  <hr class="my-4">
  <h4 class="mb-3">ЁЯТ│ р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ</h4>
  {% if payments %}
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ</th>
        <th>р╕Зр╕зр╕Фр╕Чр╕╡р╣И</th>
        <th>р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ (р╕Ър╕▓р╕Ч)</th>
        <th>р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕</th>
      </tr>
    </thead>
    <tbody>
      {% for p in payments %}
      <tr>
        <td>{{ p['payment_date'] }}</td>
        <td>{{ p['payment_phase'] }}</td>
        <td>{{ '{:,.2f}'.format(p['amount']) }}</td>
        <td>{{ p['note'] }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="text-muted">р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕▓р╕гр╕гр╕▒р╕Ър╣Ар╕Зр╕┤р╕Щ</p>
  {% endif %}

  <a href="{{ url_for('dashboard') }}" class="btn btn-secondary mt-3">тмЕя╕П р╕Бр╕ер╕▒р╕Ъ</a>
  <a href="{{ url_for('export_customer', customer_id=customer['id']) }}" class="btn btn-outline-primary mt-3">тмЗя╕П р╕кр╣Ир╕Зр╕нр╕нр╕Б PDF</a>
</div>

{% endblock %}